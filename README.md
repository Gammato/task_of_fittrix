# fitness_advertise

런지, 스쿼트, 푸시업, 레그레이즈 4종 운동에 대하여 운동 기록하기 및 기록 보기와 로그인 기능, 메인 화면에 영상 재생 기능을 구현한 앱입니다.

flutter run --release 명령어로 빌드하면 더 빠른 속도로 앱을 실행할 수 있습니다.

현재 안드로이드 버전으로만 테스트 완료했습니다.

### 구현 부분
메인 화면에는 2가지 영상이 서로 번갈아가면서 자동으로 재생됩니다.

하단에는 네비게이션 탭 바가 존재합니다.

네비게이션 탭 페이지를 이동하기 위해서는 로그인이 필요합니다.

운동 기록 하기 페이지는 4가지 운동에 대한 사진을 보고 기록을 남길 수 있습니다.

운동 기록 보기 페이지는 각 운동에 대한 기록을 보여줍니다.

로그인 상태는 로컬 스토리지에 저장하여 앱을 종료해도 풀리지 않습니다.

운동 기록 관련 페이지는 갯수 제한 없이 최상단 레이어에 계속 쌓입니다.

운동 기록 관련 페이지가 출력중일 땐 메인 화면에서 재생되는 영상은 일시 정지됩니다.

## 프로세스 요약
앱 아이콘 및 스플래시 화면 작업 --> 앱에 사용할 이미지 및 favicon 수집 --> 페이지 별 레이아웃 구현 --> API 호출용 data source 및 데이터 객체 구현 --> 로그인, 홈, 운동 기록
하기, 운동 기록 보기 순으로 세부 내용 구현

## 작업 항목 요약
1. 메인 화면에서 영상 재생 시키기
2. 운동 기록하기 화면에서 운동 기록하기
3. 운동 기록 보기 화면에서 운동 기록 보기
4. 위 기능은 미 로그인 시 접근 불가능하게 하기
5. 로그인 화면에서 로그인 하기
6. 자동 로그인 기능 및 로그아웃 구현하기
7. 페이지 간 이동 시 이상 없게 버그 잡기
8. 메인 화면 재생 중 페이지 이동 시 영상 재생 멈추기

## 개선 필요 사항
flutter_hooked, hooked_bloc, get_it, Injectable 플러그인 및 extension을 사용하여 코드 로직 부분을 분리합니다. 그로 인해 UI 로직 부분에 직관성을 더할 수 있겠습니다.

## API 설계
1. Mock API 사이트에서 id, DateTime, 긴 문장을 50여개 정도 보내도록 설정하여 운동 기록 보기에 사용함
2. Regres API 사이트에서 이메일 및 비밀번호를 송신하면 성공 여부와 토큰을 반환하는 API를 사용하여 운동 기록 하기 페이지에서 저장하기 버튼 선택 시 결괏값을 보여주는 용도로 사용했습니다.

## 사용한 패키지 및 플러그인 목록
| 제목                      | 사용목적                                                |
|-------------------------|:----------------------------------------------------|
| bloc_test               | 상태 관리 패키지 BLoC의 테스트를 위해 사용                          |
| build_runner            | 코드 생성을 위해 사용                                        |
| chewie                  | 비디오 재생을 위해 사용                                       |
| chopper                 | API 호출을 위해 사용                                       |
| chopper_generator       | API 세부 호출 구문의 자동 생성을 위해 사용                          |
| cupertino_icons         | 아이폰용 이모티콘 사용 목적                                     |
| faker                   | 더미 데이터 생성 목적                                        |
| flex_color_scheme       | 테마 색상 지정 목적                                         |
| flutter_bloc            | 상태 관리 패키지 BLoC 사용 목적                                |
| flutter_form_builder    | 여러가지 입력 폼 생성 목적                                     |
| flutter_launcher_icons  | 앱 아이콘 생성 목적                                         |
| flutter_native_splash   | 스플래시 화면 생성 목적                                       |
| freezed                 | 데이터 객체 세부 구현 자동 생성을 위해 사용                           |
| freezed_annotation      | 데이터 객체 세부 구현 자동 생성을 위해 사용                           |
| go_router               | 페이지 이동을 위해 사용                                       |
| go_router_builder       | 페이지 이동 세부 코드 자동 생성을 위해 사용                           |
| hive                    | 데이터 객체 저장을 위해 사용                                    |
| hive_flutter            | 데이터 객체 저장을 위해 사용                                    |
| hive_generator          | 데이터 객체 저장 세부 구현 자동 생성을 위해 사용                        |
| hive_test               | 데이터 객체 저장 테스트를 위해 사용                                |
| json_annotation         | 데이터 객체 세부 구현 자동 생성을 위해 사용                           |
| json_serializablelogger | 데이터 객체 세부 구현 자동 생성을 위해 사용                           |
| mockito                 | 테스트를 위해 사용                                          |
| path                    | 여러가지 로컬 경로 추출을 위해 사용                                |
| path_provider           | 여러가지 로컬 경로 추출을 위해 사용                                |
| video_player            | 비디오 재생을 위해 사용                                       |
| visibility_detector     | 홈 화면 영상 정지를 위해 홈 화면이 화면의 Z 스택 상 최상위에 있는지 감지하기 위해 사용 |

## 개발 환경
* 인텔 i7 - 6700k, 32GB 램 데스크탑 환경
* 윈도우 10 PRO 22H2 19045.3324
* IntelliJ IDEA 2023.2.1 (Ultimate Edition)
* 안드로이드 SDK 34.0.0
* Flutter 버전 3.13.1
* Dart 버전 3.1.0

## 프로젝트 빌드 & 테스트 & 실행 방법
* 인텔리제이 아이디어를 IDE로 사용했습니다.
* 플러터 프레임워크에서 제공하는 빌드 툴을 사용했습니다.
* 플러터 프레임워크에서 제공하는 테스트 기능 및 flutter_test 패키지와 mockito 패키지를 사용하여 테스트를 진행했습니다.
* Pixel 4 API 33 버전 (안드로이드13, 64비트) 에뮬레이터와 갤럭시 S7 실 기기를 사용해 앱을 실행했습니다.

## 미해결 이슈 정리
1. 홈 화면 영상 재생 중 재생 지연 이슈
    * 단말 성능의 문제인지 프레임 워크의 문제인지 코드 구조의 문제인지 파악이 어려워 해결하지 못했습니다.
2. 홈 화면 영상 재생 순서가 간헐적으로 무작위가 되는 현상
    * 페이지 이동 시 영상 재생 정지 효과를 구현하기 위해 사용한 패키지인 visibility_detector과 영상 재생 종료 시 다른 영상을 이어서 재생하는 방식이 아니라 영상 정보를 담고 있는 위젯 트리가
      교체되는 구현 방식으로 인해 발생하는 오류로 파악됩니다. 영상 재생 종료를 기점으로 위젯이 삭제 및 교체 되는 시간과 해당 패키지가 신호를 감지하려고 정보를 읽어 들이는 시간이 겹쳐 존재하지 않는
      컨트롤러를 읽으려고 시도하는 상황이 발생하며, 이 때 발생한 오류로 인해 페이지가 수차례 초기화 되면서 순서를 건너뛰어 영상이 재생됩니다. 코드 구조를 개선하는 방향으로 수정 예정입니다.
3. 바텀 네비게이션 바 중복 구현 문제
    * 해당 이슈는 미해결 문제는 아니긴 하나, 구현 미흡 부분에 속한다고 생각해 같이 기술하겠습니다.
    * 바텀 네비게이션 바의 경우 모든 페이지에 동일하게 존재하는 레이아웃이기 때문에 단일 파일로 통합 구현을 시도했습니다. 하지만
        1. 플러터 프레임워크에서 제공하는 바텀네비게이션 바의 팝업 메뉴는 하단 위치 조절이 불가능한 점(즉 팝업 메뉴의 레이아웃을 위에서 아래로만 내릴 수 있고 아래에서 위로 올릴 수 없는 현상) 이런 현상
           때문에 항상 최하단에서 팝업 메뉴가 열리게 되며, 이렇게 되면 아이콘을 가리면서 메뉴가 출력됩니다.
        2. 다른 패키지 및 플러그인 들은 1계층 네비게이션 바만 제공하고 팝업 메뉴 기능을 제공하지 않았습니다.
        3. 다른 위젯들을 통해 우회 구현하는 방법도 있긴 했으나, 그렇게 구현할 경우 팝업 애니메이션이 위에서 아래로 내려오도록 할 수 밖에 없었고, 아래에서 눌러야 하는 조건인 만큼 어색한 UX라고
           판단했습니다.
        4. 따라서 조건을 만족하기 위해선 커스텀 팝업 메뉴를 만드는 방법 밖에 없다는 생각이 들어 구현을 시작했습니다. 하지만 이 방식은 매 페이지마다 바텀 네비게이션 바를 덧씌우는 방식으로 구현되기 때문에
           이 이상 개선하지 못하고 일일이 적용하는 방식이 되었습니다.
4. 통신 실패 상황을 가정한 예외처리를 전부 포함하진 못했습니다. (인터넷 연결 상태 체크 등)
5. 최초로 API 통신을 할 때, chopper 패키지에서 API 주소를 읽어오는 과정에서 API 주소 구성의 문제(https://64ee29e31f87218271426135.mockapi.io/history) 로
   디버그 모드로 실행 시 1회 에러가 발생합니다. 이후 작동에는 문제가 없으며 API 목업 서비스를 교체해야 하는 문제라고 판단되지만 오류 발생 지점인 관계로 이슈 사항에 추가합니다.
